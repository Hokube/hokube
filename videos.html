<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Random HOKUBE Clips</title>

<style>
  :root{
    /* Let form controls follow theme */
    color-scheme: light dark;

    /* Theme tokens (light default) */
    --bg:#fff;
    --fg:#111;
    --muted:#666;
    --border:#111;

    --stage-bg:#fff;
    --fade:#fff;

    --btn-hover: .7;
  }

  /* Dark theme when forced */
  :root[data-theme="dark"]{
    --bg:#0b0f17;
    --fg:#e5e7eb;
    --muted:#a6adbb;
    --border:#2a3548;

    --stage-bg:#111827;
    --fade:#0b0f17;

    --btn-hover: .82;
  }

  /* Auto dark if user prefers dark AND no explicit theme stored */
  @media (prefers-color-scheme: dark){
    :root:not([data-theme]){
      --bg:#0b0f17;
      --fg:#e5e7eb;
      --muted:#a6adbb;
      --border:#2a3548;

      --stage-bg:#111827;
      --fade:#0b0f17;

      --btn-hover: .82;
    }
  }

  body{
    margin:0;
    background:var(--bg);
    color:var(--fg);
    font-family:"Courier New", Courier, monospace;
    font-weight:700;
    letter-spacing:.02em;
  }

  /* Marges ‚Äúexposition‚Äù */
  .page{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    padding: clamp(28px, 5vw, 72px);
    box-sizing:border-box;
  }

  .container{
    width:min(1100px, 100%);
    margin:0 auto;
    flex:1;
    display:flex;
    flex-direction:column;
  }

  .top{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:20px;
    margin-bottom:18px;
  }

  .title{
    font-size:14px;
    text-transform:uppercase;
    line-height:1.25;
  }
  .subtitle{
    margin-top:6px;
    font-size:12px;
    color:var(--muted);
    text-transform:uppercase;
  }

  /* Right side controls */
  .controls{
    display:flex;
    align-items:center;
    gap:14px;
  }

  /* D√© */
  .dice-btn{
    all:unset;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:10px;
    user-select:none;
  }
  .dice-btn:hover{ opacity:var(--btn-hover); }
  .dice-btn:focus-visible{
    outline:2px solid var(--fg);
    outline-offset:4px;
  }

  .dice-wrap{ display:inline-flex; align-items:center; justify-content:center; }
  .dice{
    width:34px; height:34px; display:block;
    transform-origin:50% 50%;
  }
  .rolling .dice{ animation: roll .42s cubic-bezier(.2,.8,.2,1); }
  .rolling{ animation: bop .42s cubic-bezier(.2,.8,.2,1); }

  @keyframes roll{
    0%   { transform: rotate(0deg) scale(1); }
    55%  { transform: rotate(180deg) scale(1.06); }
    100% { transform: rotate(360deg) scale(1); }
  }
  @keyframes bop{
    0%   { transform: translateY(0); }
    45%  { transform: translateY(-3px); }
    100% { transform: translateY(0); }
  }

  .btn-text{
    font-size:12px;
    text-transform:uppercase;
  }

  /* Theme toggle button */
  .theme-btn{
    all:unset;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:34px;
    height:34px;
    border:1.5px solid var(--border);
    border-radius:999px;
    user-select:none;
  }
  .theme-btn:hover{ opacity:var(--btn-hover); }
  .theme-btn:focus-visible{
    outline:2px solid var(--fg);
    outline-offset:4px;
  }
  .theme-icon{
    font-size:14px;
    line-height:1;
  }

  /* Zone ‚Äúprojection‚Äù */
  .stage{
    position:relative;
    width:100%;
    border:1.5px solid var(--border);
    background:var(--stage-bg);
    /* aspect ratio fa√ßon ‚Äú√©cran‚Äù */
    aspect-ratio:16/9;
    overflow:hidden;
  }
  iframe{
    width:100%;
    height:100%;
    border:none;
    display:block;
  }

  /* Fade */
  .fade{
    position:absolute;
    inset:0;
    background:var(--fade);
    pointer-events:none;
    opacity:0;
    transition: opacity 360ms ease;
  }
  .fade.show{ opacity:1; }

  .meta{
    display:flex;
    justify-content:space-between;
    gap:16px;
    margin-top:12px;
    font-size:12px;
    text-transform:uppercase;
    color:var(--muted);
  }
  .meta a{
    color:inherit;
    text-decoration:none;
    border-bottom:1px solid transparent;
  }
  .meta a:hover{ border-bottom-color:var(--muted); }

  /* Lien bas de page centr√© */
  .back{
    text-align:center;
    margin-top: clamp(26px, 4vw, 56px);
    font-size:12px;
    text-transform:uppercase;
  }
  .back a{
    color:var(--fg);
    text-decoration:none;
    border-bottom:1px solid var(--fg);
    padding-bottom:2px;
  }
  .back a:hover{ opacity:var(--btn-hover); }

  @media (max-width:520px){
    .top{ flex-direction:column; align-items:flex-start; }
    .controls{ width:100%; justify-content:space-between; }
    .meta{ flex-direction:column; align-items:flex-start; }
  }
</style>
</head>

<body>
  <div class="page">
    <div class="container">
      <div class="top">
        <div>
          <div class="title">Hokube ‚Äî Random Clips</div>
          <div class="subtitle">Roll the dice to change the projection</div>
        </div>

        <div class="controls">
          <button class="theme-btn" id="themeToggle" type="button" aria-label="Basculer le th√®me">
            <span class="theme-icon" id="themeIcon" aria-hidden="true">üåô</span>
          </button>

          <button class="dice-btn" id="roll" aria-label="Changer de clip">
            <span class="dice-wrap" id="diceWrap" aria-hidden="true">
              <svg class="dice" viewBox="0 0 64 64">
                <rect x="8" y="8" width="48" height="48" rx="10" fill="var(--fg)"/>
                <circle cx="22" cy="22" r="4" fill="var(--bg)"/>
                <circle cx="42" cy="42" r="4" fill="var(--bg)"/>
                <circle cx="42" cy="22" r="4" fill="var(--bg)"/>
                <circle cx="22" cy="42" r="4" fill="var(--bg)"/>
                <circle cx="32" cy="32" r="4" fill="var(--bg)"/>
              </svg>
            </span>
            <span class="btn-text">Roll</span>
          </button>
        </div>
      </div>

      <div class="stage" aria-label="Lecteur vid√©o">
        <iframe id="player"
          allow="autoplay; encrypted-media; picture-in-picture"
          allowfullscreen
          referrerpolicy="origin-when-cross-origin"></iframe>
        <div class="fade" id="fade"></div>
      </div>

      <div class="meta">
        <div id="status">Clip ‚Äî</div>
        <a id="openOnYt" href="#" target="_blank" rel="noreferrer">Open on YouTube</a>
      </div>

      <div class="back">
        <a href="https://www.hokube.lu" target="_self" rel="noreferrer">BACK TO HOKUBE.LU</a>
      </div>
    </div>
  </div>

<script>
  const CLIPS = [
    "UBshPLW2OCU",
    "APZLi6KSqnY",
    "q3g5W9dqEaA",
    "c5LyOyADyDI",
    "Gg8djFRQr_M",
    "uvHZdRrup5E",
    "ghdP_nRhfd4"
  ];

  const player   = document.getElementById("player");
  const rollBtn  = document.getElementById("roll");
  const diceWrap = document.getElementById("diceWrap");
  const statusEl = document.getElementById("status");
  const openOnYt = document.getElementById("openOnYt");
  const fadeEl   = document.getElementById("fade");

  // Theme toggle
  const themeToggle = document.getElementById("themeToggle");
  const themeIcon   = document.getElementById("themeIcon");
  const THEME_KEY   = "hokube-theme"; // "light" | "dark"

  function getSystemTheme(){
    return window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches
      ? "dark"
      : "light";
  }

  function getEffectiveTheme(){
    const forced = document.documentElement.getAttribute("data-theme");
    return forced || getSystemTheme();
  }

  function applyTheme(theme){ // "light" | "dark" | null
    const root = document.documentElement;
    if (!theme) root.removeAttribute("data-theme");
    else root.setAttribute("data-theme", theme);

    const effective = getEffectiveTheme();
    if (themeIcon) themeIcon.textContent = (effective === "dark") ? "‚òÄÔ∏è" : "üåô";
  }

  // Init theme from localStorage if present
  (function initTheme(){
    const saved = localStorage.getItem(THEME_KEY);
    if (saved === "light" || saved === "dark") applyTheme(saved);
    else applyTheme(null);

    // If no saved theme, update icon when OS theme changes
    if (!saved && window.matchMedia){
      const mq = window.matchMedia("(prefers-color-scheme: dark)");
      const handler = () => applyTheme(null);
      if (mq.addEventListener) mq.addEventListener("change", handler);
      else mq.addListener(handler);
    }
  })();

  if (themeToggle){
    themeToggle.addEventListener("click", () => {
      const root = document.documentElement;
      const current = root.getAttribute("data-theme"); // forced theme or null
      const next = (getEffectiveTheme() === "dark") ? "light" : "dark";
      root.setAttribute("data-theme", next);
      localStorage.setItem(THEME_KEY, next);
      applyTheme(next);
    });
  }

  let lastIndex = -1;
  let isRolling = false;

  function pickRandomNoRepeat(){
    if (CLIPS.length === 0) return -1;
    if (CLIPS.length === 1) return 0;
    let i;
    do { i = Math.floor(Math.random() * CLIPS.length); }
    while (i === lastIndex);
    return i;
  }

  function setEmbed(id, autoplay){
    const ap = autoplay ? 1 : 0;
    player.src = `https://www.youtube-nocookie.com/embed/${id}?autoplay=${ap}&rel=0&modestbranding=1`;
    openOnYt.href = `https://www.youtube.com/watch?v=${id}`;
  }

  function updateStatus(index){
    statusEl.textContent = `Clip ${index + 1} / ${CLIPS.length}`;
  }

  async function rollOnce(autoplay){
    if (isRolling) return;
    const i = pickRandomNoRepeat();
    if (i < 0) return;

    isRolling = true;

    // Anim d√© (retrigger)
    diceWrap.classList.remove("rolling");
    void diceWrap.offsetWidth;
    diceWrap.classList.add("rolling");

    // Fade
    fadeEl.classList.add("show");

    // Laisse le fade monter avant de changer la vid√©o
    await new Promise(r => setTimeout(r, 220));

    lastIndex = i;
    setEmbed(CLIPS[i], autoplay);
    updateStatus(i);

    // Laisse un poil le fade, puis fade out
    await new Promise(r => setTimeout(r, 160));
    fadeEl.classList.remove("show");

    // petite marge pour √©viter double-clic agressif
    await new Promise(r => setTimeout(r, 120));
    isRolling = false;
  }

  rollBtn.addEventListener("click", () => rollOnce(true));

  // Premier clip au hasard, sans autoplay, sans fade
  (function init(){
    if (CLIPS.length === 0) {
      statusEl.textContent = "No clips";
      openOnYt.style.display = "none";
      return;
    }
    lastIndex = Math.floor(Math.random() * CLIPS.length);
    setEmbed(CLIPS[lastIndex], false);
    updateStatus(lastIndex);
  })();
</script>
</body>
</html>
