<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Hokube's Adventure in LBV</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0a0a1a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    font-family: 'Courier New', monospace;
    overflow: hidden;
    touch-action: none;
  }
  #gameContainer {
    position: relative;
    width: 100%;
    max-width: 800px;
  }
  #gameCanvas {
    display: block;
    width: 100%;
    image-rendering: pixelated;
    border: 3px solid #00ff88;
    box-shadow: 0 0 30px #00ff8866, 0 0 60px #00ff8833;
  }
  #ui {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: linear-gradient(135deg, #0d1b0a, #001a10);
    border: 2px solid #00ff88;
    border-top: none;
    color: #00ff88;
    font-size: 14px;
    font-weight: bold;
    text-shadow: 0 0 8px #00ff88;
  }
  #title {
    text-align: center;
    color: #00ff88;
    font-size: clamp(14px, 3vw, 20px);
    font-weight: bold;
    padding: 8px;
    text-shadow: 0 0 10px #00ff88;
    letter-spacing: 2px;
  }
  /* Mobile controls */
  #controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    width: 100%;
    max-width: 800px;
    gap: 10px;
  }
  .dpad {
    display: flex;
    gap: 5px;
    align-items: center;
  }
  .btn {
    width: 55px;
    height: 55px;
    border-radius: 50%;
    border: 2px solid #00ff88;
    background: rgba(0,255,136,0.15);
    color: #00ff88;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.1s;
    box-shadow: 0 0 10px #00ff8855;
    touch-action: manipulation;
  }
  .btn:active, .btn.pressed {
    background: rgba(0,255,136,0.4);
    box-shadow: 0 0 20px #00ff88;
  }
  #jumpBtn {
    width: 65px;
    height: 65px;
    background: rgba(255,200,0,0.15);
    border-color: #ffc800;
    color: #ffc800;
    box-shadow: 0 0 10px #ffc80055;
    font-size: 14px;
  }
  #jumpBtn:active, #jumpBtn.pressed {
    background: rgba(255,200,0,0.4);
    box-shadow: 0 0 20px #ffc800;
  }
  #overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #00ff88;
    text-align: center;
    z-index: 10;
  }
  #overlay h1 {
    font-size: clamp(18px, 5vw, 32px);
    text-shadow: 0 0 20px #00ff88;
    margin-bottom: 10px;
    letter-spacing: 2px;
  }
  #overlay p {
    font-size: clamp(11px, 2.5vw, 16px);
    color: #aaffcc;
    margin: 5px 0;
  }
  #startBtn {
    margin-top: 20px;
    padding: 12px 30px;
    background: #00ff88;
    color: #000;
    border: none;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    border-radius: 4px;
    letter-spacing: 2px;
    box-shadow: 0 0 20px #00ff88;
  }
  #startBtn:hover { background: #aaffcc; }
</style>
</head>
<body>

<div id="title">üéµ HOKUBE'S ADVENTURE IN LBV üéµ</div>
<div id="gameContainer">
  <div id="overlay">
    <h1>üéµ HOKUBE'S<br>ADVENTURE IN LBV</h1>
    <p>Collecte les CDs, K7 et Vinyls !</p>
    <p>Saute sur les t√™tes des notes cass√©es !</p>
    <p>‚¨Ö ‚û° : D√©placer &nbsp;|&nbsp; ‚¨Ü / Espace : Sauter</p>
    <button id="startBtn" onclick="startGame()">‚ñ∂ JOUER</button>
  </div>
  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <div id="ui">
    <span>üíø <span id="scoreDisplay">0</span></span>
    <span>‚ù§Ô∏è <span id="livesDisplay">3</span></span>
    <span>üèÜ Score: <span id="totalDisplay">0</span></span>
  </div>
</div>
<div id="controls">
  <div class="dpad">
    <button class="btn" id="leftBtn">‚óÄ</button>
    <button class="btn" id="rightBtn">‚ñ∂</button>
  </div>
  <button class="btn" id="jumpBtn">SAUT<br>‚¨Ü</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const W = canvas.width;
const H = canvas.height;

// ---- GAME STATE ----
let gameRunning = false;
let score = 0;
let lives = 3;
let camera = { x: 0 };
let keys = {};
let frameCount = 0;
let level = 1;

// ---- COLORS ----
const COLORS = {
  sky: '#87CEEB',
  skyGrad1: '#4FC3F7',
  skyGrad2: '#B3E5FC',
  ground: '#5D4037',
  groundTop: '#8BC34A',
  building1: '#E57373',
  building2: '#F4A460',
  building3: '#90A4AE',
  window: '#FFF176',
  road: '#546E7A',
  sea: '#0077BE',
};

// ---- LEVEL DESIGN ----
const TILE = 40;
const platforms = [
  // Ground level (long)
  {x:0, y:360, w:300, h:40, type:'ground'},
  {x:350, y:360, w:200, h:40, type:'ground'},
  {x:600, y:360, w:250, h:40, type:'ground'},
  {x:900, y:360, w:300, h:40, type:'ground'},
  {x:1250, y:360, w:200, h:40, type:'ground'},
  {x:1500, y:360, w:400, h:40, type:'ground'},
  {x:1950, y:360, w:300, h:40, type:'ground'},
  {x:2300, y:360, w:500, h:40, type:'ground'},
  // Floating platforms
  {x:200, y:280, w:120, h:20, type:'plat'},
  {x:420, y:240, w:100, h:20, type:'plat'},
  {x:650, y:200, w:120, h:20, type:'plat'},
  {x:850, y:260, w:100, h:20, type:'plat'},
  {x:1050, y:220, w:120, h:20, type:'plat'},
  {x:1300, y:280, w:100, h:20, type:'plat'},
  {x:1550, y:240, w:120, h:20, type:'plat'},
  {x:1750, y:200, w:100, h:20, type:'plat'},
  {x:2000, y:260, w:120, h:20, type:'plat'},
  {x:2200, y:220, w:100, h:20, type:'plat'},
  {x:2400, y:280, w:120, h:20, type:'plat'},
  {x:2600, y:240, w:100, h:20, type:'plat'},
];

// Collectibles: type 0=CD, 1=K7, 2=Vinyl
let collectibles = [];
function generateCollectibles() {
  collectibles = [];
  const cols = [
    {x:80, y:320, t:0},{x:160, y:320, t:1},{x:240, y:240, t:2},
    {x:430, y:200, t:0},{x:500, y:320, t:1},{x:570, y:320, t:2},
    {x:660, y:160, t:0},{x:730, y:160, t:1},
    {x:870, y:220, t:2},{x:940, y:320, t:0},
    {x:1060, y:180, t:1},{x:1130, y:320, t:2},
    {x:1310, y:240, t:0},{x:1380, y:320, t:1},
    {x:1560, y:200, t:2},{x:1640, y:320, t:0},
    {x:1760, y:160, t:1},{x:1840, y:320, t:2},
    {x:2010, y:220, t:0},{x:2090, y:320, t:1},
    {x:2210, y:180, t:2},{x:2290, y:320, t:0},
    {x:2410, y:240, t:1},{x:2490, y:320, t:2},
    {x:2600, y:200, t:0},{x:2680, y:320, t:1},
  ];
  cols.forEach(c => collectibles.push({x:c.x, y:c.y, type:c.t, collected:false, bob:Math.random()*Math.PI*2}));
}

// Enemies
let enemies = [];
function generateEnemies() {
  enemies = [];
  const ens = [
    {x:350, y:330},{x:480, y:330},{x:700, y:330},
    {x:900, y:330},{x:1050, y:330},{x:1200, y:330},
    {x:1400, y:330},{x:1600, y:330},{x:1800, y:330},
    {x:2000, y:330},{x:2150, y:330},{x:2350, y:330},
    {x:2550, y:330},{x:2700, y:330},
  ];
  ens.forEach(e => enemies.push({
    x:e.x, y:e.y, w:34, h:34,
    vx: (Math.random()>0.5?1:-1)*1.2,
    dead:false, deathTimer:0,
    eyeAngle: Math.random()*Math.PI*2,
  }));
}

// ---- PLAYER ----
let player = {
  x: 80, y: 300,
  w: 28, h: 44,
  vx: 0, vy: 0,
  onGround: false,
  facing: 1,
  invincible: 0,
  animFrame: 0,
  animTimer: 0,
  jumpHeld: false,
};

// ---- INPUT ----
document.addEventListener('keydown', e => {
  keys[e.code] = true;
  if((e.code==='Space'||e.code==='ArrowUp') && player.onGround && gameRunning) { jump(); }
  e.preventDefault();
}, {passive:false});
document.addEventListener('keyup', e => { keys[e.code] = false; });

function jump() {
  player.vy = -14;
  player.onGround = false;
}

// Mobile buttons
function setupMobileBtn(id, key) {
  const btn = document.getElementById(id);
  btn.addEventListener('touchstart', e => { keys[key]=true; btn.classList.add('pressed'); e.preventDefault(); }, {passive:false});
  btn.addEventListener('touchend', e => { keys[key]=false; btn.classList.remove('pressed'); e.preventDefault(); }, {passive:false});
  btn.addEventListener('mousedown', e => { keys[key]=true; btn.classList.add('pressed'); });
  btn.addEventListener('mouseup', e => { keys[key]=false; btn.classList.remove('pressed'); });
}
setupMobileBtn('leftBtn','ArrowLeft');
setupMobileBtn('rightBtn','ArrowRight');

const jumpBtn = document.getElementById('jumpBtn');
jumpBtn.addEventListener('touchstart', e => {
  if(player.onGround && gameRunning) jump();
  jumpBtn.classList.add('pressed');
  e.preventDefault();
}, {passive:false});
jumpBtn.addEventListener('touchend', e => { jumpBtn.classList.remove('pressed'); e.preventDefault(); }, {passive:false});
jumpBtn.addEventListener('mousedown', e => { if(player.onGround && gameRunning) jump(); jumpBtn.classList.add('pressed'); });
jumpBtn.addEventListener('mouseup', e => { jumpBtn.classList.remove('pressed'); });

// ---- COLLISION ----
function rectOverlap(a, b) {
  return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y;
}

function resolvePlayerPlatforms() {
  player.onGround = false;
  for (let p of platforms) {
    if (rectOverlap(player, p)) {
      const overlapX = Math.min(player.x+player.w, p.x+p.w) - Math.max(player.x, p.x);
      const overlapY = Math.min(player.y+player.h, p.y+p.h) - Math.max(player.y, p.y);
      if (overlapY < overlapX) {
        if (player.vy >= 0 && player.y+player.h-player.vy <= p.y+4) {
          player.y = p.y - player.h;
          player.vy = 0;
          player.onGround = true;
        } else if (player.vy < 0) {
          player.y = p.y + p.h;
          player.vy = 0;
        }
      } else {
        if (player.x < p.x) player.x = p.x - player.w;
        else player.x = p.x + p.w;
        player.vx = 0;
      }
    }
  }
}

// ---- DRAW FUNCTIONS ----

function drawBackground() {
  // Sky gradient
  const grad = ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,'#1a3a6e');
  grad.addColorStop(0.6,'#4fc3f7');
  grad.addColorStop(1,'#b8e0f7');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,W,H);

  // Sun
  const sunX = 680 - camera.x*0.05;
  ctx.save();
  ctx.shadowColor = '#FFF9C4';
  ctx.shadowBlur = 30;
  ctx.fillStyle = '#FFF176';
  ctx.beginPath(); ctx.arc(sunX,60,28,0,Math.PI*2); ctx.fill();
  ctx.restore();

  // Clouds
  drawCloud(100 - camera.x*0.1, 60, 80);
  drawCloud(340 - camera.x*0.12, 40, 60);
  drawCloud(600 - camera.x*0.08, 80, 90);
  drawCloud(900 - camera.x*0.1, 50, 70);
  drawCloud(1200 - camera.x*0.09, 70, 80);

  // Background buildings (Libreville skyline)
  drawBgBuildings();

  // Ocean glimpse at bottom right
  ctx.fillStyle = '#0077BE';
  ctx.globalAlpha = 0.3;
  ctx.fillRect(0, 370, W, 30);
  ctx.globalAlpha = 1;
}

function drawCloud(x, y, size) {
  ctx.fillStyle = 'rgba(255,255,255,0.85)';
  ctx.beginPath();
  ctx.arc(x, y, size*0.4, 0, Math.PI*2);
  ctx.arc(x+size*0.3, y-size*0.1, size*0.3, 0, Math.PI*2);
  ctx.arc(x+size*0.6, y, size*0.35, 0, Math.PI*2);
  ctx.fill();
}

function drawBgBuildings() {
  // Draw Libreville-style buildings in background
  const bldgs = [
    {x:50, y:200, w:60, h:160, c:'#8D6E63', windows:true},
    {x:130, y:220, w:45, h:140, c:'#78909C', windows:true},
    {x:300, y:180, w:70, h:180, c:'#A1887F', windows:true},
    {x:420, y:210, w:50, h:150, c:'#90A4AE', windows:true},
    {x:550, y:190, w:80, h:170, c:'#8D6E63', windows:true},
    {x:700, y:230, w:40, h:130, c:'#78909C', windows:true},
    {x:800, y:200, w:60, h:160, c:'#BCAAA4', windows:true},
    {x:950, y:185, w:90, h:175, c:'#90A4AE', windows:true},
    {x:1100, y:210, w:55, h:150, c:'#8D6E63', windows:true},
    {x:1300, y:195, w:70, h:165, c:'#78909C', windows:true},
    {x:1500, y:215, w:60, h:145, c:'#BCAAA4', windows:true},
    {x:1700, y:200, w:80, h:160, c:'#8D6E63', windows:true},
    {x:1900, y:220, w:50, h:140, c:'#90A4AE', windows:true},
    {x:2100, y:190, w:75, h:170, c:'#78909C', windows:true},
    {x:2350, y:205, w:65, h:155, c:'#8D6E63', windows:true},
    {x:2550, y:215, w:55, h:145, c:'#BCAAA4', windows:true},
  ];
  for(let b of bldgs) {
    const bx = b.x - camera.x*0.3;
    ctx.fillStyle = b.c;
    ctx.fillRect(bx, b.y, b.w, b.h);
    // Windows
    ctx.fillStyle = frameCount%120<60?'#FFF9C4':'#F9A825';
    for(let wy=b.y+15; wy<b.y+b.h-20; wy+=22) {
      for(let wx=bx+8; wx<bx+b.w-8; wx+=15) {
        if(Math.random()>0.3) { // static windows, seeded by position
          ctx.globalAlpha = 0.7;
          ctx.fillRect(wx,wy,8,10);
          ctx.globalAlpha = 1;
        }
      }
    }
  }
}

function drawPlatforms() {
  for(let p of platforms) {
    const px = p.x - camera.x;
    if(px > W+50 || px+p.w < -50) continue;
    if(p.type==='ground') {
      // Grass top
      ctx.fillStyle = '#388E3C';
      ctx.fillRect(px, p.y, p.w, 8);
      // Dirt
      ctx.fillStyle = '#5D4037';
      ctx.fillRect(px, p.y+8, p.w, p.h-8);
      // Road markings
      ctx.fillStyle = '#37474F';
      ctx.fillRect(px, p.y+20, p.w, 10);
      ctx.fillStyle = '#FFF';
      for(let rx=px; rx<px+p.w; rx+=40) {
        ctx.fillRect(rx+5, p.y+23, 20, 4);
      }
    } else {
      // Floating platform - wooden style
      ctx.fillStyle = '#795548';
      ctx.fillRect(px, p.y, p.w, p.h);
      ctx.fillStyle = '#8BC34A';
      ctx.fillRect(px, p.y, p.w, 6);
      // Wood grain
      ctx.strokeStyle = '#6D4C41';
      ctx.lineWidth = 1;
      for(let gx=px; gx<px+p.w; gx+=18) {
        ctx.beginPath(); ctx.moveTo(gx,p.y+6); ctx.lineTo(gx,p.y+p.h); ctx.stroke();
      }
    }
  }
}

function drawCollectible(c) {
  if(c.collected) return;
  const cx = c.x - camera.x;
  if(cx < -20 || cx > W+20) return;
  const bob = Math.sin(c.bob + frameCount*0.08)*3;
  const cy = c.y + bob;
  ctx.save();
  ctx.shadowBlur = 12;

  if(c.type===0) { // CD
    ctx.shadowColor = '#00e5ff';
    // Outer disc
    const grd = ctx.createRadialGradient(cx,cy,0,cx,cy,15);
    grd.addColorStop(0,'#fff');
    grd.addColorStop(0.3,'#b3e5fc');
    grd.addColorStop(0.6,'#e040fb');
    grd.addColorStop(1,'#00e5ff');
    ctx.fillStyle = grd;
    ctx.beginPath(); ctx.arc(cx,cy,15,0,Math.PI*2); ctx.fill();
    ctx.fillStyle = '#333';
    ctx.beginPath(); ctx.arc(cx,cy,4,0,Math.PI*2); ctx.fill();
    // Shine
    ctx.fillStyle = 'rgba(255,255,255,0.4)';
    ctx.beginPath(); ctx.ellipse(cx-4,cy-4,5,3,-0.5,0,Math.PI*2); ctx.fill();
  } else if(c.type===1) { // K7 (cassette)
    ctx.shadowColor = '#ffab00';
    ctx.fillStyle = '#212121';
    ctx.fillRect(cx-13,cy-9,26,18);
    ctx.fillStyle = '#ffab00';
    ctx.fillRect(cx-11,cy-7,22,14);
    // Cassette holes
    ctx.fillStyle = '#212121';
    ctx.beginPath(); ctx.arc(cx-5,cy,4,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(cx+5,cy,4,0,Math.PI*2); ctx.fill();
    // Tape
    ctx.fillStyle = '#333';
    ctx.fillRect(cx-5,cy-1,10,3);
    // Label text
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 5px Courier New';
    ctx.fillText('K7',cx-4,cy-3);
  } else { // Vinyl
    ctx.shadowColor = '#76ff03';
    ctx.fillStyle = '#1a1a1a';
    ctx.beginPath(); ctx.arc(cx,cy,14,0,Math.PI*2); ctx.fill();
    // Grooves
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 1;
    for(let r=7;r<=13;r+=2) { ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke(); }
    // Label
    ctx.fillStyle = '#76ff03';
    ctx.beginPath(); ctx.arc(cx,cy,5,0,Math.PI*2); ctx.fill();
    ctx.fillStyle = '#000';
    ctx.font = 'bold 4px Courier New';
    ctx.textAlign='center'; ctx.fillText('LBV',cx,cy+1.5); ctx.textAlign='left';
  }
  ctx.restore();
}

function drawEnemy(e) {
  if(e.dead) {
    if(e.deathTimer>0) {
      const ex = e.x - camera.x;
      ctx.save();
      ctx.globalAlpha = e.deathTimer/30;
      ctx.fillStyle = '#ff4444';
      ctx.font = 'bold 20px Courier New';
      ctx.fillText('üí•', ex-10, e.y - (30-e.deathTimer));
      ctx.restore();
    }
    return;
  }
  const ex = e.x - camera.x;
  if(ex < -50 || ex > W+50) return;
  
  ctx.save();
  // Body - broken music note
  ctx.fillStyle = '#b71c1c';
  ctx.strokeStyle = '#ff1744';
  ctx.lineWidth = 2;
  
  // Note head
  ctx.beginPath();
  ctx.ellipse(ex, e.y+e.h-10, 12, 9, -0.3, 0, Math.PI*2);
  ctx.fill(); ctx.stroke();
  
  // Note stem
  ctx.beginPath();
  ctx.moveTo(ex+11, e.y+e.h-10);
  ctx.lineTo(ex+11, e.y+5);
  ctx.stroke();
  
  // Broken flag
  ctx.beginPath();
  ctx.moveTo(ex+11, e.y+5);
  ctx.lineTo(ex+22, e.y+12);
  ctx.lineTo(ex+18, e.y+20);
  ctx.stroke();
  
  // Cracks
  ctx.strokeStyle = '#ff6b6b';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(ex-5, e.y+e.h-15);
  ctx.lineTo(ex+2, e.y+e.h-8);
  ctx.lineTo(ex-2, e.y+e.h-4);
  ctx.stroke();
  
  // Mean eyes
  const eyeOffset = Math.sin(e.eyeAngle)*2;
  // Left eye
  ctx.fillStyle = '#fff';
  ctx.beginPath(); ctx.ellipse(ex-4,e.y+e.h-14+eyeOffset,4,3,0,0,Math.PI*2); ctx.fill();
  ctx.fillStyle = '#ff1744';
  ctx.beginPath(); ctx.arc(ex-3,e.y+e.h-14+eyeOffset,2,0,Math.PI*2); ctx.fill();
  // Right eye
  ctx.fillStyle = '#fff';
  ctx.beginPath(); ctx.ellipse(ex+5,e.y+e.h-14+eyeOffset,4,3,0,0,Math.PI*2); ctx.fill();
  ctx.fillStyle = '#ff1744';
  ctx.beginPath(); ctx.arc(ex+6,e.y+e.h-14+eyeOffset,2,0,Math.PI*2); ctx.fill();
  
  // Angry eyebrows
  ctx.strokeStyle = '#ff1744';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(ex-8,e.y+e.h-19+eyeOffset); ctx.lineTo(ex,e.y+e.h-17+eyeOffset);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(ex+2,e.y+e.h-17+eyeOffset); ctx.lineTo(ex+10,e.y+e.h-19+eyeOffset);
  ctx.stroke();
  
  // Angry mouth
  ctx.beginPath();
  ctx.moveTo(ex-4,e.y+e.h-7); ctx.lineTo(ex,e.y+e.h-5); ctx.lineTo(ex+5,e.y+e.h-7);
  ctx.stroke();
  
  ctx.restore();
}

function drawPlayer() {
  if(player.invincible > 0 && Math.floor(player.invincible/5)%2===0) return;
  const px = player.x - camera.x;
  const py = player.y;

  ctx.save();
  ctx.scale(player.facing, 1);
  const fpx = player.facing === 1 ? px : -px - player.w;

  // Shadow
  ctx.fillStyle = 'rgba(0,0,0,0.2)';
  ctx.ellipse && ctx.beginPath();
  ctx.beginPath(); ctx.ellipse(fpx+player.w/2, py+player.h+2, player.w/2, 5, 0, 0, Math.PI*2); ctx.fill();

  // Legs (animated)
  const legAnim = player.onGround ? Math.sin(frameCount*0.3)*8 : 0;
  ctx.fillStyle = '#1565C0'; // jean blue
  // Left leg
  ctx.fillRect(fpx+2, py+28, 10, 16+Math.max(0,legAnim));
  // Right leg
  ctx.fillRect(fpx+16, py+28, 10, 16-Math.min(0,legAnim));
  
  // Shoes
  ctx.fillStyle = '#333';
  ctx.fillRect(fpx, py+40, 13, 6);
  ctx.fillRect(fpx+14, py+40, 13, 6);
  
  // Body - white t-shirt
  ctx.fillStyle = '#FFFFFF';
  ctx.fillRect(fpx+2, py+16, 24, 16);
  
  // T-shirt design (music note)
  ctx.fillStyle = '#00cc66';
  ctx.font = 'bold 9px Courier New';
  ctx.fillText('‚ô™', fpx+8, py+27);
  
  // Arms
  ctx.fillStyle = '#8D5524'; // skin
  const armAnim = player.onGround ? Math.cos(frameCount*0.3)*6 : 0;
  // Left arm
  ctx.fillRect(fpx-5, py+17, 8, 12);
  // Right arm
  ctx.fillRect(fpx+25, py+17, 8, 12);
  
  // Neck
  ctx.fillStyle = '#8D5524';
  ctx.fillRect(fpx+9, py+8, 10, 10);
  
  // Head
  ctx.fillStyle = '#8D5524';
  ctx.beginPath();
  ctx.ellipse(fpx+14, py+7, 13, 11, 0, 0, Math.PI*2);
  ctx.fill();
  
  // Hair (short natural hair)
  ctx.fillStyle = '#111';
  ctx.beginPath();
  ctx.ellipse(fpx+14, py+1, 12, 7, 0, Math.PI, Math.PI*2);
  ctx.fill();
  ctx.fillRect(fpx+2, py+1, 24, 5);
  
  // Eye
  ctx.fillStyle = '#fff';
  ctx.fillRect(fpx+17, py+6, 5, 4);
  ctx.fillStyle = '#111';
  ctx.fillRect(fpx+19, py+7, 3, 3);
  
  // Smile
  ctx.strokeStyle = '#111';
  ctx.lineWidth = 1.5;
  ctx.beginPath();
  ctx.arc(fpx+16, py+11, 4, 0.1, Math.PI-0.1);
  ctx.stroke();
  
  ctx.restore();
}

function drawHUD() {
  // Top bar
  ctx.fillStyle = 'rgba(0,0,0,0.5)';
  ctx.fillRect(0,0,W,32);
  ctx.fillStyle = '#00ff88';
  ctx.font = 'bold 16px Courier New';
  ctx.textShadow = '0 0 8px #00ff88';
  ctx.fillText(`üíø ${score}`, 10, 22);
  ctx.fillText(`‚ù§Ô∏è ${lives}`, W/2-30, 22);
  ctx.fillText(`Lv.${level}`, W-60, 22);
}

// ---- PARTICLES ----
let particles = [];
function spawnParticles(x,y,color,count=8) {
  for(let i=0;i<count;i++) {
    const angle = (Math.PI*2/count)*i;
    particles.push({
      x, y,
      vx: Math.cos(angle)*3,
      vy: Math.sin(angle)*3-2,
      life: 30,
      color,
      size: 4+Math.random()*4,
    });
  }
}
function updateParticles() {
  particles = particles.filter(p=>p.life>0);
  for(let p of particles) {
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.2; p.life--;
    const px2 = p.x - camera.x;
    ctx.save();
    ctx.globalAlpha = p.life/30;
    ctx.fillStyle = p.color;
    ctx.beginPath(); ctx.arc(px2,p.y,p.size*(p.life/30),0,Math.PI*2); ctx.fill();
    ctx.restore();
  }
}

// ---- GAME LOGIC ----
function updatePlayer() {
  const speed = 4.5;
  
  if(keys['ArrowLeft']) { player.vx = -speed; player.facing = -1; }
  else if(keys['ArrowRight']) { player.vx = speed; player.facing = 1; }
  else { player.vx *= 0.7; }
  
  if((keys['ArrowUp']||keys['Space']) && player.onGround) jump();
  
  player.vy += 0.65; // gravity
  if(player.vy > 18) player.vy = 18;
  
  player.x += player.vx;
  player.y += player.vy;
  
  // World bounds
  if(player.x < 0) { player.x=0; player.vx=0; }
  
  resolvePlayerPlatforms();
  
  // Camera
  camera.x = Math.max(0, player.x - W*0.35);
  
  // Fall death
  if(player.y > H+50) {
    playerDie();
  }
  
  // Invincibility timer
  if(player.invincible > 0) player.invincible--;
  
  // Animation
  player.animTimer++;
  if(player.animTimer>8) { player.animFrame=(player.animFrame+1)%4; player.animTimer=0; }
}

function updateEnemies() {
  for(let e of enemies) {
    if(e.dead) { if(e.deathTimer>0) e.deathTimer--; continue; }
    e.eyeAngle += 0.05;
    e.x += e.vx;
    // Bounce off platforms
    let onPlat = false;
    for(let p of platforms) {
      const rect = {x:e.x,y:e.y,w:e.w,h:e.h};
      if(rectOverlap(rect,p)) {
        if(e.vy>=0&&e.y+e.h-e.vy<=p.y+4){e.y=p.y-e.h;e.vy=0;onPlat=true;}
        // bounce at edges
        if(e.x<=p.x||e.x+e.w>=p.x+p.w) { e.vx*=-1; }
      }
    }
    e.vy = e.vy||0;
    e.vy += 0.5;
    e.y += e.vy;
    if(e.y > H+50) { e.dead=true; e.deathTimer=0; }
    
    // Enemy vs player
    if(!e.dead && player.invincible===0) {
      if(rectOverlap(player,{x:e.x,y:e.y,w:e.w,h:e.h})) {
        // Check if player is above (stomping)
        if(player.vy > 0 && player.y+player.h < e.y+e.h/2+5) {
          // Kill enemy
          e.dead = true; e.deathTimer = 30;
          player.vy = -10; // bounce
          score += 50;
          spawnParticles(e.x+e.w/2, e.y, '#ff4444');
          updateHUD();
        } else {
          playerDie();
        }
      }
    }
  }
}

function updateCollectibles() {
  for(let c of collectibles) {
    if(c.collected) continue;
    const cr = {x:c.x-12,y:c.y-12,w:24,h:24};
    if(rectOverlap(player,cr)) {
      c.collected = true;
      const colors = ['#00e5ff','#ffab00','#76ff03'];
      const pts = [10, 20, 30];
      spawnParticles(c.x, c.y, colors[c.type], 10);
      score += pts[c.type];
      updateHUD();
    }
  }
}

function playerDie() {
  if(player.invincible>0) return;
  lives--;
  player.invincible = 120;
  spawnParticles(player.x+player.w/2, player.y+player.h/2, '#ff4444', 12);
  document.getElementById('livesDisplay').textContent = lives;
  if(lives<=0) {
    setTimeout(()=>gameOver(), 500);
  } else {
    // Reset position
    player.x = 80; player.y = 300;
    player.vx = 0; player.vy = 0;
    camera.x = 0;
  }
}

function updateHUD() {
  document.getElementById('scoreDisplay').textContent = score;
  document.getElementById('livesDisplay').textContent = lives;
  document.getElementById('totalDisplay').textContent = score;
}

function gameOver() {
  gameRunning = false;
  const overlay = document.getElementById('overlay');
  overlay.innerHTML = `
    <h1>GAME OVER</h1>
    <p>Score final: ${score}</p>
    <p>Hokube continue son aventure √† LBV ! üá¨üá¶</p>
    <button id="startBtn" onclick="startGame()" style="margin-top:20px;padding:12px 30px;background:#ff4444;color:#fff;border:none;font-size:18px;font-weight:bold;cursor:pointer;border-radius:4px;">REJOUER</button>
  `;
  overlay.style.display = 'flex';
}

function checkLevelComplete() {
  const allCollected = collectibles.every(c => c.collected);
  const allDead = enemies.every(e => e.dead);
  const reachedEnd = player.x > 2700;
  if(reachedEnd) {
    gameRunning = false;
    const overlay = document.getElementById('overlay');
    overlay.innerHTML = `
      <h1>üéâ VICTOIRE ! üéâ</h1>
      <p>Bravo Hokube ! Tu as termin√© l'aventure √† Libreville !</p>
      <p>Score: ${score} pts</p>
      <p>üíø Collectibles: ${collectibles.filter(c=>c.collected).length}/${collectibles.length}</p>
      <p>üá¨üá¶ Gabon Pride ! üéµ</p>
      <button id="startBtn" onclick="startGame()" style="margin-top:20px;padding:12px 30px;background:#00ff88;color:#000;border:none;font-size:18px;font-weight:bold;cursor:pointer;border-radius:4px;">REJOUER</button>
    `;
    overlay.style.display = 'flex';
  }
}

// ---- MAIN LOOP ----
function gameLoop() {
  if(!gameRunning) return;
  frameCount++;
  
  ctx.clearRect(0,0,W,H);
  
  drawBackground();
  drawPlatforms();
  
  // Draw collectibles
  for(let c of collectibles) drawCollectible(c);
  
  // Update & draw enemies
  updateEnemies();
  for(let e of enemies) drawEnemy(e);
  
  // Update player
  updatePlayer();
  updateCollectibles();
  
  drawPlayer();
  updateParticles();
  drawHUD();
  
  checkLevelComplete();
  
  requestAnimationFrame(gameLoop);
}

function startGame() {
  score = 0; lives = 3; frameCount = 0; level = 1;
  player = { x:80, y:300, w:28, h:44, vx:0, vy:0, onGround:false, facing:1, invincible:0, animFrame:0, animTimer:0 };
  camera = { x: 0 };
  particles = [];
  keys = {};
  generateCollectibles();
  generateEnemies();
  updateHUD();
  document.getElementById('overlay').style.display = 'none';
  gameRunning = true;
  gameLoop();
}
</script>
</body>
</html>
